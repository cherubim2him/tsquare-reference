<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>5. Database Configuration</title>
<link rel="stylesheet" href="styles/pos.css" type="text/css">
<link rel="stylesheet" href="styles/styles.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.70.0">
<link rel="start" href="install-overview.html" title="Installation Guide">
<link rel="up" href="install-overview.html" title="Installation Guide">
<link rel="prev" href="install-config.html" title="4. Post-Installation Configuration">
<link rel="next" href="install-tshoot.html" title="6. Troubleshooting">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div id="frame">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">5. Database Configuration</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="install-config.html">Prev</a> </td>
<th width="60%" align="center"> </th>
<td width="20%" align="right"> <a accesskey="n" href="install-tshoot.html">Next</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="sect1" lang="en">
<div class="titlepage"><div><div><h2 class="title">
<a name="install-dbconfig"></a>5. Database Configuration</h2></div></div></div>

        <p>Text</p>
        <div class="sect2" lang="en">
<div class="titlepage"><div><div><h3 class="title">
<a name="id5033261"></a>5.1. Migrating from an Earlier Version</h3></div></div></div>

            <p>There are database schema changes between 2.1.1 and 2.1.2, and the update scripts
                to be applied - in distinct versions for MySQL and Oracle, respectively - are found
                in the docs/updating folder of the release or on subversion:</p>
            <div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td>
<span class="term">MySQL</span></td>
<td>
                        <p>https://source.sakaiproject.org/svn/tags/sakai_2-1-2/docs/updating/sakai_2_1_1-2_1_2_mysql_conversion.sql</p>
                    </td>
</tr>
<tr>
<td>
<span class="term">Oracle</span></td>
<td>
                        <p>https://source.sakaiproject.org/svn/tags/sakai_2-1-2/docs/updating/sakai_2_1_1-2_1_2_oracle_conversion.sql</p>
                    </td>
</tr>
</tbody>
</table></div>
            <p>In the same directory you'll also find conversion scripts for earlier Sakai
                versions. Migration from an earlier version will require the successive application
                of all intermediate update scripts. You cannot, for example, move from 2.0.1 to
                2.1.1 by applying a single DB script. You will need to move first from 2.0.1 to
                2.1.0, and then to 2.1.1.</p>
            <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Examine before using</h3>

                <p>As a general rule, be sure to read through these conversion scripts before
                    applying them. The 2.0-2.1 script, in particular, includes notes about roles
                    that may spare you a potential headache if you've been running 2.0 in
                    production.</p>
            </div>
        </div>
        <div class="sect2" lang="en">
<div class="titlepage"><div><div><h3 class="title">
<a name="id5153630"></a>5.2. Deploy Drivers</h3></div></div></div>

            <p>The supported production-grade databases include MySQL 4.1+ and Oracle 9i+. The
                version of the JDBC driver (or connector) is also important. For MySQL the 3.1.12
                connector should be used, while for Oracle the 10g driver must be used, even if the
                database is Oracle 9i. These drivers should be copied into your
                $CATALINA_HOME/common/lib directory, and they are available from the official sites:</p>
            <div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td>
<span class="term">MySQL</span></td>
<td>
                        <p>http://dev.mysql.com/downloads/connector/j/3.1.html</p>
                    </td>
</tr>
<tr>
<td>
<span class="term">Oracle</span></td>
<td>
                        <p>http://www.oracle.com/technology/software/tech/java/sqlj_jdbc/index.html</p>
                    </td>
</tr>
</tbody>
</table></div>
            <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Driver Versions</h3>

                <p>Database driver versions are a common source of problems. It's worth
                    emphasizing again that the Oracle 10g driver must be used for Sakai
                    installations running against Oracle, even when Oracle 9i is the database
                    version.</p>

                <p>Problems have been reported for both the 3.1.10 and 3.1.11 MySQL drivers.
                    3.1.12 is the recommended version.</p>
            </div>
        </div>
        <div class="sect2" lang="en">
<div class="titlepage"><div><div><h3 class="title">
<a name="id5153705"></a>5.3. Create Database and User</h3></div></div></div>

            <p>A Sakai database and privileged user must be prepared for Sakai's use. Consult
                your database documentation for details, but below are sample commands for MySQL.
                Note in particular that the database needs to be configured for the UTF-8 character
                set.</p>
            <pre class="screen">
C:\sakai\reference\sql\legacy\mysql\&gt;
mysql -u root -p
Enter password: ******
Welcome to the MySQL monitor. Commands end with ; or \g.

Your MySQL connection id is 51 to server version: 4.1.5-gamma-nt

Type 'help;' or '\h' for help. Type '\c' to clear the buffer.

mysql&gt; create database sakai default character set utf8;
Query OK, 1 row affected (0.00 sec)

mysql&gt; grant all on sakai.* to sakaiuser@'localhost' identified by 'sakaipassword';
Query OK, 0 rows affected (0.00 sec

mysql&gt; grant all on sakai.* to sakaiuser@'127.0.0.1' identified by 'sakaipassword';
Query OK, 0 rows affected (0.00 sec)

mysql&gt; quit</pre>
        </div>
        <div class="sect2" lang="en">
<div class="titlepage"><div><div><h3 class="title">
<a name="id5153727"></a>5.4. Database Properties</h3></div></div></div>

            <p>There are settings in sakai.properties that also define the database technology
                and connection information. Appropriate <code class="filename">sakai.properties</code>
                settings for Oracle and MySQL, respectively, are listed below (although some pieces
                will of course need to be altered appropriately for your installation):</p>
            <div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td>
<span class="term">MySQL</span></td>
<td>
                        <pre class="screen">
hibernate.dialect=org.hibernate.dialect.MySQLDialect
vendor@org.sakaiproject.db.api.SqlService=mysql
driverClassName@javax.sql.BaseDataSource=com.mysql.jdbc.Driver
url@javax.sql.BaseDataSource=jdbc:mysql://SERVER:3306/DB?useUnicode=true&amp;characterEncoding=UTF-8
username@javax.sql.BaseDataSource=USER
password@javax.sql.BaseDataSource=PASSWORD
validationQuery@javax.sql.BaseDataSource=select 1 from DUAL
defaultTransactionIsolationString@javax.sql.BaseDataSource=TRANSACTION_READ_COMMITTED</pre>
                    </td>
</tr>
<tr>
<td>
<span class="term">Oracle</span></td>
<td>
                        <pre class="screen">
hibernate.dialect=org.hibernate.dialect.Oracle9Dialect
vendor@org.sakaiproject.db.api.SqlService=oracle
driverClassName@javax.sql.BaseDataSource=oracle.jdbc.driver.OracleDriver
url@javax.sql.BaseDataSource=jdbc:oracle:thin:@SERVER:1521:DB
username@javax.sql.BaseDataSource=USER
password@javax.sql.BaseDataSource=PASSWORD
validationQuery@javax.sql.BaseDataSource=select 1 from DUAL
defaultTransactionIsolationString@javax.sql.BaseDataSource=TRANSACTION_READ_COMMITTED</pre>
                    </td>
</tr>
</tbody>
</table></div>
            <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Oracle Performance</h3>

                <p>Oracle may have performance problems with some of the SQL settings that work
                    for HSQL and MySQL. Sakai installations using Oracle should strongly consider
                    the following settings in <code class="filename">sakai.properties</code> to avoid these
                    problems:</p>
                <pre class="screen">
# For improved Oracle performance (from the University of Michigan)
validationQuery@javax.sql.BaseDataSource=
defaultTransactionIsolationString@javax.sql.BaseDataSource=
testOnBorrow@javax.sql.BaseDataSource=false</pre>
                <p>Oracle should be set to the proper settings for the first two items (above)
                    automatically; setting them with each use may affect performace. In addition,
                    validating the connection on each transaction caused problems in at least one
                    large production environment (University of Michigan).</p>
            </div>
            <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Oracle and Tests&amp;Quizzes</h3>

                <p>If you're running Oracle you should check the datatype of the "MEDIA" column
                    in the SAM_MEDIA_T table. Hibernate tries to choose the right data type for a
                    field, but has a habit of choosing the wrong one for Oracle. The correct types
                    for each database are:</p>
                <div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td>
<span class="term">HSQL</span></td>
<td>
                            <p>varbinary</p>
                        </td>
</tr>
<tr>
<td>
<span class="term">MySQL</span></td>
<td>
                            <p>longblob</p>
                        </td>
</tr>
<tr>
<td>
<span class="term">Oracle</span></td>
<td>
                            <p>blob</p>
                        </td>
</tr>
</tbody>
</table></div>
                <p>If you need to change this type for your database, this will also involve
                    finding the primary key constraint, dropping it and then recreating it. Contact
                    your local DBA for further information on making this change. Below is some
                    sample Oracle SQLplus output to better illustrate (SYS_C0064435 is the example
                    constraint; replace it with yours): </p>
                <pre class="screen">
SQL&gt; alter table SAM_MEDIA_T modify MEDIA BLOB;

Table altered.

SQL&gt; select constraint_name from user_constraints where table_name='SAM_MEDIA_T'
and CONSTRAINT_TYPE='P';

CONSTRAINT_NAME
------------------------------
SYS_C0064435

SQL&gt; alter table sam_media_t drop constraint SYS_C0064435;

Table altered.

SQL&gt; alter table SAM_MEDIA_T add constraint SYS_C0064435 primary key (MEDIAID);

Table altered.

SQL&gt; desc SAM_MEDIA_T;

[table with BLOB type]

SQL&gt; select constraint_name from user_constraints where table_name='SAM_MEDIA_T'
and CONSTRAINT_TYPE='P';

CONSTRAINT_NAME
------------------------------
SYS_C0064435

SQL&gt; commit;

Commit complete.</pre>
            </div>
        </div>
    </div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="install-config.html">Prev</a> </td>
<td width="20%" align="center"> </td>
<td width="40%" align="right"> <a accesskey="n" href="install-tshoot.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">4. Post-Installation Configuration </td>
<td width="20%" align="center"><a accesskey="h" href="install-overview.html">Home</a></td>
<td width="40%" align="right" valign="top"> 6. Troubleshooting</td>
</tr>
</table>
</div>
<br clear="all"></div>
</body>
</html>
